/** @jsx React.DOM */

'use strict';

var React = require('react');

// sub-components
var TodoList = require('./todo-list');
var TodoInput = require('./todo-input');

module.exports = React.createClass({
    displayName: 'TodoApp',

    getInitialState: function() {
        return {items: [], index: 0, text: ''};
    },

    onChange: function (e) {
        this.setState({text: e.target.value});
    },

    handleSubmit: function (e) {
        // you should not be able to input empty todo's
        if (this.state.text.length < 1) return false;

        var currentIndex = this.state.index;

        e.preventDefault(); // could also use return false

        var nextItems = this.state.items.concat([{id: 'todo-' + currentIndex, text: this.state.text}]);
        var nextText = '';

        this.setState({items: nextItems, text: nextText, index: currentIndex + 1});
    },

    handleDelete: function (childProps) {
        var newList = this.state.items;

        // remove the requested item
        newList.map(function (item, index, list) {
            if (childProps.key == item.id) {
                list.splice(index, 1);
            }
        });

        this.setState({items: newList});
    },

    render: function() {
        return (
            <div className="panel panel-default">
                <h3>TODO ({this.state.items.length} items)</h3>
                <TodoList
                    items={this.state.items}
                    handleDelete={this.handleDelete}
                />
                <TodoInput
                    handleSubmit={this.handleSubmit}
                    handleChange={this.onChange}
                    items={this.state.items.length + 1}
                    text={this.state.text}
                />
            </div>
        );
    }
});
